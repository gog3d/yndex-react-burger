{"ast":null,"code":"export const createWsMiddleware = (wsUrl, wsActions) => {\n  const wsMiddleware = store => {\n    let socket = null;\n    return next => action => {\n      const {\n        dispatch\n      } = store;\n      const {\n        type,\n        payload\n      } = action;\n      const {\n        wsStart,\n        wsDisconnect,\n        onOpen,\n        onError,\n        onMessage,\n        onClose\n      } = wsActions;\n\n      if (type === wsStart) {\n        console.log(`${wsUrl}${payload}`);\n        socket = new WebSocket(`${wsUrl}${payload}`);\n      }\n\n      if (socket) {\n        socket.onopen = event => {\n          dispatch({\n            type: onOpen\n          });\n        };\n\n        socket.onerror = event => {\n          console.log(`ws error: ${event}`);\n          dispatch({\n            type: onError\n          });\n        };\n\n        socket.onmessage = event => {\n          const {\n            data\n          } = event;\n          dispatch({\n            type: onMessage,\n            payload: JSON.parse(data)\n          });\n        };\n\n        socket.close = event => {\n          dispatch({\n            type: onClose\n          });\n        };\n\n        if (type === wsDisconnect) {\n          console.log('disconnect');\n          socket.close();\n          dispatch(onClose());\n        }\n      }\n\n      next(action);\n    };\n  };\n\n  return wsMiddleware;\n};","map":{"version":3,"names":["createWsMiddleware","wsUrl","wsActions","wsMiddleware","store","socket","next","action","dispatch","type","payload","wsStart","wsDisconnect","onOpen","onError","onMessage","onClose","console","log","WebSocket","onopen","event","onerror","onmessage","data","JSON","parse","close"],"sources":["/home/gog3d/JS/6-yndex-react/0-project/react-burger/src/redux/middleware/wsMiddleware.ts"],"sourcesContent":["import { ActionCreatorWithoutPayload, ActionCreatorWithPayload } from '@reduxjs/toolkit';\r\nimport { Middleware, MiddlewareAPI, AnyAction } from 'redux';\r\nimport { AppDispatch, RootState } from '../store';\r\n\r\nexport type TwsActionTypes = {\r\n  wsStart: ActionCreatorWithPayload<string>,\r\n  wsDisconnect: ActionCreatorWithoutPayload,\r\n  //wsSendMessage?: ActionCreatorWithPayload<any>,\r\n  //wsConnecting: ActionCreatorWithoutPayload,\r\n  onOpen: ActionCreatorWithoutPayload,\r\n  onClose: ActionCreatorWithoutPayload,\r\n  onError: ActionCreatorWithPayload<string>,\r\n  onMessage: ActionCreatorWithPayload<any>,\r\n}\r\nexport const createWsMiddleware = (wsUrl: string, wsActions: TwsActionTypes): Middleware  => {\r\n  const wsMiddleware = (store: MiddlewareAPI<AppDispatch, RootState>) => {\r\n    let socket: WebSocket | null = null;\r\n    return (next:AppDispatch) => (action: AnyAction) => {\r\n      const { dispatch } = store;\r\n      const { type, payload } = action;\r\n      const {\r\n        wsStart,\r\n        wsDisconnect,\r\n        onOpen,\r\n        onError,\r\n        onMessage,\r\n        onClose\r\n      } = wsActions;\r\n      if (type === wsStart) {\r\n        console.log(`${wsUrl}${payload}`);\r\n        socket = new WebSocket(`${wsUrl}${payload}`);\r\n      }\r\n      if (socket) {\r\n        socket.onopen = event => {\r\n          dispatch({type: onOpen});\r\n        };\r\n        socket.onerror = event => {\r\n          console.log(`ws error: ${event}`);\r\n          dispatch({type: onError});\r\n        };\r\n        socket.onmessage = event => {\r\n          const { data } = event;\r\n          dispatch({type: onMessage, payload: JSON.parse(data)});\r\n        };\r\n        socket.close = event => {\r\n           dispatch({type: onClose});\r\n        };\r\n        \r\n        if (type === wsDisconnect) {\r\n          console.log('disconnect');\r\n          socket.close();\r\n          dispatch(onClose());\r\n        }\r\n      }\r\n      next(action);\r\n    }\r\n  };\r\n  return wsMiddleware;\r\n};"],"mappings":"AAcA,OAAO,MAAMA,kBAAkB,GAAG,CAACC,KAAD,EAAgBC,SAAhB,KAA2D;EAC3F,MAAMC,YAAY,GAAIC,KAAD,IAAkD;IACrE,IAAIC,MAAwB,GAAG,IAA/B;IACA,OAAQC,IAAD,IAAuBC,MAAD,IAAuB;MAClD,MAAM;QAAEC;MAAF,IAAeJ,KAArB;MACA,MAAM;QAAEK,IAAF;QAAQC;MAAR,IAAoBH,MAA1B;MACA,MAAM;QACJI,OADI;QAEJC,YAFI;QAGJC,MAHI;QAIJC,OAJI;QAKJC,SALI;QAMJC;MANI,IAOFd,SAPJ;;MAQA,IAAIO,IAAI,KAAKE,OAAb,EAAsB;QACpBM,OAAO,CAACC,GAAR,CAAa,GAAEjB,KAAM,GAAES,OAAQ,EAA/B;QACAL,MAAM,GAAG,IAAIc,SAAJ,CAAe,GAAElB,KAAM,GAAES,OAAQ,EAAjC,CAAT;MACD;;MACD,IAAIL,MAAJ,EAAY;QACVA,MAAM,CAACe,MAAP,GAAgBC,KAAK,IAAI;UACvBb,QAAQ,CAAC;YAACC,IAAI,EAAEI;UAAP,CAAD,CAAR;QACD,CAFD;;QAGAR,MAAM,CAACiB,OAAP,GAAiBD,KAAK,IAAI;UACxBJ,OAAO,CAACC,GAAR,CAAa,aAAYG,KAAM,EAA/B;UACAb,QAAQ,CAAC;YAACC,IAAI,EAAEK;UAAP,CAAD,CAAR;QACD,CAHD;;QAIAT,MAAM,CAACkB,SAAP,GAAmBF,KAAK,IAAI;UAC1B,MAAM;YAAEG;UAAF,IAAWH,KAAjB;UACAb,QAAQ,CAAC;YAACC,IAAI,EAAEM,SAAP;YAAkBL,OAAO,EAAEe,IAAI,CAACC,KAAL,CAAWF,IAAX;UAA3B,CAAD,CAAR;QACD,CAHD;;QAIAnB,MAAM,CAACsB,KAAP,GAAeN,KAAK,IAAI;UACrBb,QAAQ,CAAC;YAACC,IAAI,EAAEO;UAAP,CAAD,CAAR;QACF,CAFD;;QAIA,IAAIP,IAAI,KAAKG,YAAb,EAA2B;UACzBK,OAAO,CAACC,GAAR,CAAY,YAAZ;UACAb,MAAM,CAACsB,KAAP;UACAnB,QAAQ,CAACQ,OAAO,EAAR,CAAR;QACD;MACF;;MACDV,IAAI,CAACC,MAAD,CAAJ;IACD,CAtCD;EAuCD,CAzCD;;EA0CA,OAAOJ,YAAP;AACD,CA5CM"},"metadata":{},"sourceType":"module"}